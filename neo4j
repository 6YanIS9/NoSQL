
import sqlite3
from py2neo import Graph, Node, Relationship

# Connexion à la base de données SQLite
conn = sqlite3.connect('infractions.db')
cursor = conn.cursor()

# Connexion à Neo4j
graph = Graph("bolt://localhost:7687", auth=("neo4j", "123456789"))

# Importation des données des tables
cursor.execute("SELECT * FROM infractions")
infractions = cursor.fetchall()

cursor.execute("SELECT * FROM départements")
departements = cursor.fetchall()

cursor.execute("SELECT * FROM force_odre")
forces_ordre = cursor.fetchall()

cursor.execute("SELECT * FROM annee")
annees = cursor.fetchall()

cursor.execute("SELECT * FROM périmètres")
perimetres = cursor.fetchall()

cursor.execute("SELECT * FROM brigade")
brigades = cursor.fetchall()

cursor.execute("SELECT * FROM fait")
faits = cursor.fetchall()

# Création des nœuds et relations dans Neo4j
for infraction in infractions:
    node = Node("Infraction", code_infr=infraction[0], lib_infr=infraction[1])
    graph.create(node)

for departement in departements:
    node = Node("Departement", code_dep=departement[0], nom_dep=departement[1])
    graph.create(node)

for force in forces_ordre:
    node = Node("ForceOrdre", force_odre=force[0])
    graph.create(node)

for annee in annees:
    node = Node("Annee", annee=annee[0])
    graph.create(node)

for perimetre in perimetres:
    node = Node("Perimetre", lib_perimetre=perimetre[0], force_odre=perimetre[1])
    graph.create(node)

for brigade in brigades:
    node = Node("Brigade", id_brigade=brigade[0], lib_brigade=brigade[1], lib_perimetre=brigade[2], code_dep=brigade[3], force_odre=brigade[4])
    graph.create(node)

for fait in faits:
    infraction_node = graph.nodes.match("Infraction", code_infr=fait[0]).first()
    brigade_node = graph.nodes.match("Brigade", id_brigade=fait[1]).first()
    annee_node = graph.nodes.match("Annee", annee=fait[2]).first()
    relation = Relationship(brigade_node, "A_COMMIS", infraction_node, annee=fait[2], nb_infraction=fait[3])
    graph.create(relation)

# Fermez la connexion SQLite
conn.close()

print("Données importées dans Neo4j avec succès!")
